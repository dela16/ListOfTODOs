@page
@model ListOfTODOs.Pages.ItemIndexModel
@{
    ViewData["Title"] = "ToDo List";
}

<form id="add-item-form">
	Activity: <input type="text" name="ItemToDo" value="" placeholder="Add an activity"/> <button class="btn btn-dark" id="post-item">Add item</button>
</form>

<form id="list-items-form">
	<nav id="taskList">
		<ul class="mt-3" id="itemsOnToDoList">
			<li>
				<input type="checkbox" id="bock" />Såhär vill jag att det ska se ut
			</li>
		</ul>
	</nav>
</form>

<form id="delete-item-form">
	Id: <input type="number" name="ItemToDelete" value="" placeholder="What id to delete?" /> <button class="btn btn-success" id="delete-item">Complete Task / Remove</button>
</form>


<form id="item-to-update-form">
	Id: <input type="number" name="ItemId" value="" placeholder="What id to edit?"/>
	Edit: <input type="text" name="ItemToUpdate" value="" placeholder="Re-write your task"/> <button class="btn btn-dark" id="update-item">Update</button>
</form>


@section Scripts{
	<script>
        let postItemBtn = document.getElementById("post-item");
		let itemsOnToDoList = document.getElementById("itemsOnToDoList");
		let deleteItemBtn = document.getElementById("delete-item");
		let updateItemBtn = document.getElementById("update-item");

		function showAllItemsInList(){
			fetch("/items")
			.then(respons => respons.json())
			.then(data => {
				for(let i = 1; i < data.length; i++){
					const checkbox = document.createElement("input");
					const li = document.createElement("li");
					checkbox.type = "checkbox";
					checkbox.addEventListener('click', () => {
						if(checkbox.checked){
							li.style.textDecoration = "line-through" //Jag får i konsol online att li is not defined. Varför?
						}
						else{
							li.style.textDecoration = "none";
						}
					});
						
					li.innerText = `Id: ${data[i].id} - ${data[i].activity}`;
					li.appendChild(checkbox);

					//const deleteBtn = document.createElement("button");
					//deleteBtn.addEventListener('click', (event){
					//	delete();
					//});
					itemsOnToDoList.appendChild(li);
					//itemsOnToDoList.appendChild(deleteBtn);
				}
			})
		};



		showAllItemsInList();

		postItemBtn.addEventListener('click', () => {
			const postItemForm = document.getElementById("add-item-form").elements;

			const itemInfo =
			{
				Activity: postItemForm.namedItem("ItemToDo").value
				//if(postItemForm.namedItem("ItemToDo").value is null){
				//	break;
				//}
			};
			
			const clearInputField = {
				Activity: postItemForm.namedItem("ItemToDo").value=''
			};

			postItemInfo("/items", itemInfo);

        })

		itemsOnToDoList.addEventListener('click', () => {
			li.style.textDecoration = "line.through"; 
		})

		//vad gör denna?
		const postItemInfo = (url = '', data = {}) => {
		console.log(JSON.stringify(data))
		fetch(url, {
			method: 'POST',
			headers: {
				'Content-Type': 'application/json'
			},
			body: JSON.stringify(data)
		})
			.then(response => console.log(response));
		}

		updateItemBtn.addEventListener('click', () => { //Denna uppdateras inte direkt, bara i db. Måste ladda om sidan.
			const updateItemForm = document.getElementById("item-to-update-form").elements;
			const updateItemId = updateItemForm.namedItem("ItemId").value;
			const updateItemInfo = {Activity: updateItemForm.namedItem("ItemToUpdate").value};

			const clearInputField = {
				Activity: updateItemForm.namedItem("ItemToUpdate").value=''
			};

			putItemInfo("/items/" + updateItemId, updateItemInfo); 
		})

		const putItemInfo = (url = '', data = {}) => { //återigen denna. 
			console.log(JSON.stringify(data))
			fetch(url,{
				method: 'PUT',
				headers: {
					'Content-Type': 'application/json'
				},
				body: JSON.stringify(data)
			})
			.then(response => console.log(response));
		}


			deleteItemBtn.addEventListener('click', () => {
			const deleteItemForm = document.getElementById("delete-item-form").elements; //Byta ut denna raden mot checkbox. 

			const deleteItemInfo = deleteItemForm.namedItem("ItemToDelete").value;

			const clearInputField = {
				Activity: deleteItemForm.namedItem("ItemToDelete").value = ''
			};

			deleteFunction("/items/" + deleteItemInfo, {});
			});

		const deleteFunction = (url = '', data = {}) => { //Återigen, kolla vad denna gör. Behöver jag den? Denna gör den aktiva kopplingen till db och raderar? 
			console.log(JSON.stringify(data))
			fetch(url, {
				method: 'DELETE',
				headers: {
					'Content-Type': 'application/json'
				},
				body: JSON.stringify(data)
			})
				.then(response => console.log(response));
		}
		
		


    </script>
}